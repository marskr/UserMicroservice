# UsersMicroservice 

This is a simple [microservice](https://docs.microsoft.com/pl-pl/dotnet/standard/microservices-architecture/multi-container-microservice-net-applications/data-driven-crud-microservice) created for users management.  
Technology: [ASP .NET Core](https://docs.microsoft.com/pl-pl/aspnet/core/?view=aspnetcore-2.1) API with basic CRUD (CRUD for HTTP resources) operations for users and admins.

## Microservice description

This Microservice is responsible for basic Create, Read, Update & Delete operations. In case of making any of mentioned operations safe, autorization management were developed. Additional info:  
* To manage authorization Jason Web Tokens wereincluded. Please check [JWT](https://jwt.io/),
* Any password provided by user is encrypted by the Microservice (RSA algorithm) & inserted into SQL Server Database,
* Salt for encryption is generated by the Microservice & stored in database,
* Any token generated by authorization method is valid for 12 hours.

### Authorization methods

1. Authenticate using _CreateToken_ method by sending email & password. As a result you will obtain token. Any token is valid for 12 hours from now,
2. Check if token is valid using _CheckIfAuthorized_. 

## "Users" http methods

### ShowUser 

**Title :** Show user by email.  
**URL :** /api/Users/:email  
**Method :** GET  
**URL Params :** Required: email = [string]   
**Data Params :**  
{  
  "Email": [String],   
  "Name": [String],  
  "Surname": [String],   
  "PhoneNumber": [Int],  
  "HashPassword": [String],  
  "UserAccountStatus": [String],  
  "AccountStatusChangeDate": [DateTime],  
  "Salt": [String],  
  "AuthToken": [String],   
  "AuthTokenExpiration": [DateTime],  
  "PermissionId": [Int]  
}      
**Response Codes :** Success (200 OK) 


### AddUser

**Title :** Add new user.  
**URL :** /api/Users  
**Method :** POST  
**URL Params :**  NONE  
**Data Params :**  
{  
  "Email": [String] **Required Unique**,   
  "Name": [String] **Required**,  
  "Surname": [String] **Required**,   
  "PhoneNumber": [Int] **Required**,  
  "HashPassword": [String] **Required**,  
  "UserAccountStatus": [String] **Required**,  
  "AccountStatusChangeDate": [DateTime] **Non-Required**,  
  "Salt": [String] **Non-Required**,  
  "AuthToken": [String] **Non-required**,   
  "AuthTokenExpiration": [DateTime] **Non-required**,  
  "PermissionId": [Int]  **Non-Required**   
}   
**Response Codes :** Success (200 OK)  
**Annotation :** Id will be updated automatically by application!  


### UpdateUser

**Title :** Update user.  
**URL :** /api/Users/:email  
**Method :** PUT  
**URL Params :** Required: email = [string]   
**Data Params :**   
{  
  "Email": [String] **Non-required**,   
  "Name": [String] **Required**,  
  "Surname": [String] **Required**,   
  "PhoneNumber": [Int] **Required**,  
  "HashPassword": [String] **Required**,  
  "UserAccountStatus": [String] **Non-required**,  
  "AccountStatusChangeDate": [DateTime] **Non-required**,  
  "Salt": [String] **Non-required**,  
  "AuthToken": [String] **Non-required**,   
  "AuthTokenExpiration": [DateTime] **Non-required**,  
  "PermissionId": [Int] **Non-required**  
}      
**Response Codes :** Success (200 OK)  
**Annotation :** You can update Name, Surname, PhoneNumber & Password! 


### DeleteUser

**Title :** Delete old user.  
**URL :** /api/Users/:email  
**Method :** DELETE  
**URL Params :** Required: email = [string]   
**Data Params :** NONE  
**Response Codes :** Success (200 OK)


## "Authentication" http methods

### CheckIfAuthorized 

**Title :** Check if provided token is valid.  
**URL :** /api/Authentication/:token  
**Method :** GET  
**URL Params :** Required: token = [string]   
**Data Params :**  NONE  
**Response Body :** TRUE (if token is valid) or FALSE (if not)  
**Response Codes :** Success (200 OK)  

### CreateToken

**Title :** Create a token using provided email & password. Token value will be returned as result.   
**URL :** /api/Authentication/:email/:password  
**Method :** POST  
**URL Params :** Required: email = [string] and password = [string]  
**Data Params :**  NONE  
**Response Body :** string containing JWF token  
**Response Codes :** Success (200 OK)  


## Short description of data used by microservice

##### **_Name_** | **_CodeType_** | **_DatabaseType_** | **_Required?_** | **_Example_** : **_Description_**
  
**Email | _String_ | _VARCHAR(30)_ | _YES_ :**   
_Required. An email provided must be unique! Maximum email length is 30._  
 
**Name | _String_ | _VARCHAR(20)_ |  _YES_ :**  
_Required. The maximum length of any name is 20._  

**Surname | _String_ | _VARCHAR(20)_ | _YES_ :**  
_Required. The maximum length of any surname is 20._  

**PhoneNumber | _Integer_ | _INT_ | _YES_ :**  
_Required. The number should be 9 characters long._  

**Password | _String_ | _VARCHAR(MAX)_ | _YES_ :**   
_Required. Given password will be subsequently encrypted by algorithm & stored in database._  

**UserAccountStatus | _String_ | _VARCHAR(30)_ |  _YES_ :**  
_Required. Currently we can distinguish 2 types of UserAccountStatus - "normal" & "premium". Maximum 30 characters long._  

**AccountStatusChangeDate | _DateTime_ | _DATE_ | _YES_ :**  
_Non required. The date format is YYYY-MM-DD._  

**Salt | _String_ | _VARCHAR(30)_ | _NO_ :**    
_Non required. Created salt by the Microservice will be used to encrypt password._  

**AuthToken | _String_ | _VARCHAR(MAX)_ | _NO_ :**  
_Non required. Token will be generated by the Microservice._  

**AuthTokenExpiration | _DateTime_ | _DATETIME_ | _NO_ :**  
_Non required. Expiration date will be generated in Authentication process. The date format is YYYY-MM-DD HH:MM:SS._  

**PermissionId | _Integer_ | _INT_ | _YES_ :**  
_Non required. For normal user 0, for administrator 1, for application 2._  

## http responses & error handling

As a result no matter what happens, you should obtain the 200 status code. The real information about what is particular response is placed in response body. Response body basis is structure below:

	public class Error
    {
        public int Code { get; set; }
        public string Message { get; set; }
        public string Details { get; set; }
        public string Url { get; set; }
    }
    
    public class JsonErrorResponses
    {
        public HttpStatusCode StatusCode { get; set; }
        public string Result { get; set; }
        public bool Success { get; set; }
        public Error ErrorContainer { get; set; }
    }

**_Code_** - type of an error code. Possible error codes are:

* 0 - everything is fine, action finished properly,
* 1 - authorization error (wrong login or password),
* 2 - validation error (provided token is not valid),
* 3 - validation error (provided user not found in database),
* 4 - exception error (API have threw an exception),
* 5 - post error (user exists in database),
* 6 - delete error (user not exists in database),
* 7 - length error (user exceeded the length limitation on particular field),
* 8 - forbidden sign error (user passed forbidden sign, in example name can contain only letters). 

**_Message_** - short information about the message,  
**_Details_** - additional description about the message,  
**_Url_** - the url address of additional documentation,  
**_StatusCode_** - type of a status code. Possible status codes are:

* OK (200),
* Unauthorized (401),
* BadRequest (400).  

**_Result_** - contain result of request (in example token value),  
**_Success_** - true if action were succesfully finished, false if not,  
**_ErrorContainer_** - contains all fields from Error class.

